<!DOCTYPE html><html lang="kr"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/e124e0da229202d9.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-c62b9263dde95db3.js" as="script"/><link rel="preload" href="/_next/static/chunks/fd9d1056-5fc0659828b82348.js" as="script"/><link rel="preload" href="/_next/static/chunks/596-5f69a5936ae99734.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-app-b1c29a2c9712c92e.js" as="script"/><title>11장 - 뉴스 피드 시스템 설계</title><meta name="description" content="11장 - 뉴스 피드 시스템 설계 정리본"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="google-site-verification" content="LXzAKbA2-HVF1l60gXdTElFNxVVLxh1rk6qwe1V41so"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_f367f3"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNZJJHJW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="w-full flex flex-col items-center p-3"><header class="w-full max-w-3xl flex flex-row justify-between items-center my-1"><a class="flex flex-row items-center" href="/"><img alt="로고" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" class="rounded-full" style="color:transparent" src="/logo.png"/><span class="mx-2 font-semibold text-lg">jiohh blog</span></a><nav><a class="mr-5 " href="/">Home</a><a class="mr-5 " href="/blog">Blog</a><a class="mr-5 " href="/category">Category</a></nav></header><main class="w-full max-w-3xl"><div class="mt-10 prose"><h1 class="">11장 - 뉴스 피드 시스템 설계</h1><h2>목표</h2>
<p>뉴스피드는 여러분의 홈 페이지 중아에 지속적으로 업데이트되는 스토리들로 사용자 상태 정보 업데이트, 사진, 비디오, 링크, 앱 활동, 팔우하는 사람들, 페이지등을 포함한다고 설명하고있다.
이러한 뉴스피드를 설계하여보자.</p>
<h2>1단계 문제 이해 및 설계 범위 확정</h2>
<p>어떤 기능을 지원해야하는지 반드시 파악해야 한다.</p>
<p>지원자 질문</p>
<ul>
<li>모바일 앱, 웹 둘다 지원해야하는지?</li>
<li>중요한 기능은 무엇인지</li>
<li>뉴스피드에는 어떤 순서로 스토리가 표시되어야 하는지?
최신 포스트가 위에? 토픽점수(가까운 친구의 포스트) 기준이 있는지?</li>
<li>한 명의 사용자는 최대 몇 명의 친구를 가질 수 있는지?</li>
<li>트래픽 규모는 어느 정도인지?</li>
<li>피드에 이미지나 비디오도 올라올 수 있는지?</li>
</ul>
<p>면접관 질문</p>
<ul>
<li>모바일 앱, 웹 둘다 지원해야함</li>
<li>중요한 기능으로 사용자는 뉴스 피드 페이지에 새로운 스토리를 올릴 수 있어야 하고, 친구들이 올리는 스토리를 볼 수도 있어야 한다.</li>
<li>시간 흐름 역순으로 피드 표현</li>
<li>한명은 최대 5000명과 친구 가능</li>
<li>트래픽의 규모는 매일 천만 명 방문</li>
<li>피드에 이미지나 비디오등 미디어 파일이 포함되어야함</li>
</ul>
<h2>2단계 개략적 설계안 제시 및 동의 구하기</h2>
<p>피드발행, 뉴스 피드 생성 두가지 부분으로 나누어 개략적 설계</p>
<ul>
<li>피드 발행 : 피드를 생성하면 해당 데이터를 캐시와 데이터베이스에 기록하고 뉴스 피드에 전송된다.</li>
<li>뉴스 피드 생성 : 뉴스 피드는 모든 친구의 포스팅을 역순으로 모아서 만든다고 가정</li>
</ul>
<h3>뉴스 피드 API</h3>
<p>HTTP 기반으로 여러 작업을 수행하는 데 사용한다. 가장 중요한 두 가지 API를 알아보자</p>
<h4>피드 발행 API</h4>
<p>새 스토리를 포스팅하기 위한 API</p>
<p>인자</p>
<ul>
<li>body : 포스팅 내용</li>
<li>Authorization 헤더 : API 호출을 인증하기 위해 사용</li>
</ul>
<h4>피드 읽기 API</h4>
<p>뉴스 피드를 가져오는 API</p>
<p>인자</p>
<ul>
<li>Authorization 헤더 : API 호출을 인증하기 위해 사용</li>
</ul>
<h3>피드 발행</h3>
<img src="/images/LSS/publishFeed.jpg" width="60%" height="100%"/>
<p>피드 발행 시스템의 개략적 형태는 다음과 같다.</p>
<ul>
<li>사용자 : 모바일 앱이나 브라우저에서 새 포스팅을 올리는 주체</li>
<li>로드밸런서 : 트래픽을 웹 서버들로 분산한다.</li>
<li>웹 서버 : HTTP 요청을 내부 서비스로 중계하는 역할을 담당한다.</li>
<li>포스팅 저장 서비스 : 새 포스팅을 데이터베이스와 캐시에 저장</li>
<li>포스팅 전송 서비스 : 새 포스팅을 친구의 뉴스 피드에 푸시한다.
뉴스 피드 데이터는 캐시에 보관하여 빠르게 읽어갈 수 있도록 한다.</li>
<li>알림 서비스 : 친구들에게 새 포스팅이 올라왔음을 알림, 푸시 알림을 보냄</li>
</ul>
<h3>피드 생성</h3>
<img src="/images/LSS/createNewsFeed.jpg" width="50%" height="100%"/>
<ul>
<li>뉴스 피드 서비스 : 캐시에서 뉴스 피드를 가져오는 서비스다.</li>
<li>뉴스 피드 캐시 : 뉴스 피드를 랜더링할 때 필요한 피드 ID를 보관</li>
</ul>
<h2>3단계 상세 설계</h2>
<h3>피드 발행 흐름 상세 설계</h3>
<img src="/images/LSS/publishFeedDetail.jpg" width="80%" height="100%"/>
<h4>웹 서버</h4>
<p>클라이언트와 통신 + 인증 + 처리율 제한 등 기능도 수행해야함</p>
<p>인증 : 인가한 사람만 게시물 등록
처리율 제한 : 스팸, 유해한 콘텐츠가 자주 올라오는 것을 방지하기 위해 특정기간 올리 수 있는 포스팅 수 제한</p>
<h4>포스팅 전송(팬아웃) 서비스</h4>
<p>포스팅 전송은 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정이다.<br/>
<!-- -->fanout에는 두가지 모델이 있다.</p>
<ol>
<li>
<p>쓰기 시점에 팬아웃(fanout-on-write)<br/>
<!-- -->포스팅을 기록하는 시점에 뉴스 피드를 갱신, 해당 사용자의 캐시에 해당 포스팅을 기록하는 것</p>
<p>장점</p>
<ul>
<li>뉴스 피드가 실시간으로 갱신되며 친구 목록에 있는 사요자에게 즉시 전송</li>
<li>기록되는 순간 뉴스 피드가 이미 갱신되므로 뉴스 피드를 읽는 데 드는 시간이 짧아진다.</li>
</ul>
<p>단점</p>
<ul>
<li>친구가 많은 사용자의 경우 그 목록에 있는 사용자의 뉴스피드를 갱신하는데 많은 시간이 소요(핫키,hotkey 문제)</li>
<li>서비스를 자주 이용하지 않는 사용자의 피드까지 갱신함으로 자원이 낭비</li>
</ul>
</li>
<li>
<p>읽기 시점에 팬아웃(fanout-on-read)<br/>
<!-- -->피드를 읽어야하는 시점에 뉴스 피드를 갱신, 요청 기반 모델<br/>
<!-- -->즉, 사용자가 페이지를 로딩하는 시점에 포스트를 가져옴</p>
<p>장점</p>
<ul>
<li>자주 사용하지않는 사용자, 비활성화된 사용자의 경우 유리</li>
<li>데이터를 친구 각각에 푸시하는 작업이 없어 핫키 문제가 생기지 않음</li>
</ul>
<p>단점</p>
<ul>
<li>뉴스 피드를 읽는 데 많은 시간이 소요될 수 있다.</li>
</ul>
</li>
</ol>
<p>이 두가지 방법을 결합하여 장점은 취하고 단점은 버리는 전략 사용</p>
<ul>
<li>대부분의 사용자에 대해서 쓰기 시점에 팬 아웃하는 모델을 사용</li>
<li>팔로어가 아주 많은 사용자의 경우 읽기 시점에 팬 아웃하는 모델을 사용하여 과부화 방지<br/>
<!-- -->안정 해시를 이용해 요처오가 데이터를 고르게 분산하여 핫키 문제를 줄임</li>
</ul>
<p>실제 팬아웃 서비스는 다음과 같이 작동한다</p>
<ol>
<li>그래프 데이터베이스에서 친구 ID목록을 가져옴</li>
<li>사용자 정보 캐시에서 친구들의 정보 가져옴, 사용자 설정에 따라 친구 가운데 일부를 걸러냄(차단기능)</li>
<li>친구 목록과 새 스토리의 포스팅 ID를 메시지 큐에 넣는다.</li>
<li>팬아웃 작업서버가 메시지 큐에서 데이터를 꺼내 뉴스 피드 데이터를 뉴스 피드 캐시에 넣는다.<br/>
<!-- -->뉴스 피드 캐시는 (포스팅 ID, 사용자 ID) 순서쌍으로 보관한다.</li>
</ol>
<h3>피드 읽기 흐름 상세 설계안</h3>
<img src="/images/LSS/createNewsFeedDetail.jpg" width="80%" height="100%"/>
<p>이미자나 비디오는 CDN을 이용하여 빨리 읽어갈 수 있도록 최적화한다.</p>
<ol>
<li>사용자의 요청이 들어온다.</li>
<li>로드밸런서가 요청을 웹서버 가운데 하나로 보낸다.</li>
<li>웹서버는 뉴스 피드 서비스를 호출해 피드를 가져온다.</li>
<li>뉴스 피드 서비스는 뉴스 피드 캐시에서 포스팅 ID 목록을 가져온다.</li>
<li>뉴스 피드에 표시할 정보등을 사용자 캐시와 포스팅 캐시에서 가져와 완젼한 뉴스피드를 만든다.</li>
<li>생성된 뉴스피드는 JSON형태로 클라이언트에게 보낸다. 클라이언트는 해당 피드를 랜더링한다.</li>
</ol>
<h3>캐시 구조</h3>
<p>캐시는 뉴스 피드 시스템의 핵심 컴포넌트다.
다음과 같이 다섯 계층으로 나누어 설계하였다.</p>
<ul>
<li>뉴스피드 : 뉴스피드<br/>
<!-- -->뉴스 피드의 ID 보관</li>
<li>콘텐츠 : 인기 콘텐츠, 일반 콘텐츠<br/>
<!-- -->포스팅 데이터를 보관한다. 인기 콘텐츠는 따로 보관</li>
<li>소셜 그래프 : 팔로워, 팔로잉<br/>
<!-- -->사용자 간 관계 정보 보관</li>
<li>행동 : &#x27;좋아요&#x27;, 답글, 기타<br/>
<!-- -->포스팅에 대한 사용자의 행위 정보 보관</li>
<li>횟수 : 좋아요 횟수, 답글 횟수, 기타<br/>
<!-- -->여러 횟수 정보를 보관한다.</li>
</ul>
<h2>4단계 마무리</h2>
<p>이번 설계안은 뉴스피드 발행과 생성의 두 부분으로 구성되어 있다.<br/>
<!-- -->설계 후 시간이 좀 남는다면 규모 확장성 이슈(데이터 베이스 규모확장)를 논의해보는 것도 괜찮다.</p>
<p>이외에도 다음과 같은 항목을 이야기 해볼만하다.</p>
<ul>
<li>웹 계층 을 무상태로 운영하기</li>
<li>가능한 한 많은 데이터를 캐시할 방법</li>
<li>여러 데이터 센터를 지원할 방법</li>
<li>메시지 큐를 사용하여 컴포넌트 사이의 결합도 낮추기</li>
<li>핵심 메트릭에 대한 모니터링<br/>
<!-- -->트래픽이 몰리는 시간 대의 QPS, 뉴스피드를 새로고침 할 떄의 지연시간 등</li>
</ul></div></main><footer class="w-full max-w-3xl items-center "><div class="h-28"></div> </footer></div><script src="/_next/static/chunks/webpack-c62b9263dde95db3.js" async=""></script><script src="/_next/static/chunks/fd9d1056-5fc0659828b82348.js" async=""></script><script src="/_next/static/chunks/596-5f69a5936ae99734.js" async=""></script><script src="/_next/static/chunks/main-app-b1c29a2c9712c92e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/e124e0da229202d9.css\",{\"as\":\"style\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-c62b9263dde95db3.js\",\"971:static/chunks/fd9d1056-5fc0659828b82348.js\",\"596:static/chunks/596-5f69a5936ae99734.js\"],\"name\":\"default\",\"async\":false}\n6:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-c62b9263dde95db3.js\",\"971:static/chunks/fd9d1056-5fc0659828b82348.js\",\"596:static/chunks/596-5f69a5936ae99734.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-1c7543f9470b706b.js\",\"222:static/chunks/222-846c3dee61afe17f.js\",\"404:static"])</script><script>self.__next_f.push([1,"/chunks/app/blog/page-4c4ed4280d9bd9ea.js\"],\"name\":\"\",\"async\":false}\n8:I{\"id\":3222,\"chunks\":[\"685:static/chunks/685-1c7543f9470b706b.js\",\"222:static/chunks/222-846c3dee61afe17f.js\",\"404:static/chunks/app/blog/page-4c4ed4280d9bd9ea.js\"],\"name\":\"Image\",\"async\":false}\n9:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-c62b9263dde95db3.js\",\"971:static/chunks/fd9d1056-5fc0659828b82348.js\",\"596:static/chunks/596-5f69a5936ae99734.js\"],\"name\":\"default\",\"async\":false}\na:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpa"])</script><script>self.__next_f.push([1,"ck-c62b9263dde95db3.js\",\"971:static/chunks/fd9d1056-5fc0659828b82348.js\",\"596:static/chunks/596-5f69a5936ae99734.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e124e0da229202d9.css\",\"precedence\":\"next\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"YNK-Xsel8BoFXXzqLrVMY\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/LSS11\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"LSS11\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"LSS11\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":\"$L5\",\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"kr\",\"children\":[null,[\"$\",\"body\",null,{\"className\":\"__className_f367f3\",\"children\":[[\"$\",\"noscript\",null,{\"children\":[\"$\",\"iframe\",null,{\"src\":\"https://www.googletagmanager.com/ns.html?id=GTM-WNZJJHJW\",\"height\":\"0\",\"width\":\"0\",\"style\":{\"display\":\"none\",\"visibility\":\"hidden\"}}]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col items-center p-3\",\"children\":[null,[\"$\",\"header\",null,{\"className\":\"w-full max-w-3xl flex flex-row justify-between items-center my-1\",\"children\":[[\"$\",\"$L7\",null,{\"href\":\"/\",\"className\":\"flex flex-row items-center\",\"children\":[[\"$\",\"$L8\",null,{\"src\":\"/logo.png\",\"alt\":\"로고\",\"width\":30,\"height\":30,\"objectFit\":\"cover\",\"className\":\"rounded-full\"}],[\"$\",\"span\",null,{\"className\":\"mx-2 font-semibold text-lg\",\"children\":\"jiohh blog\"}]]}],[\"$\",\"nav\",null,{\"children\":[[\"$\",\"$L7\",\"Home\",{\"href\":\"/\",\"className\":\"mr-5 \",\"children\":\"Home\"}],[\"$\",\"$L7\",\"Blog\",{\"href\":\"/blog\",\"className\":\"mr-5 \",\"children\":\"Blog\"}],[\"$\",\"$L7\",\"Category\",{\"href\":\"/category\",\"className\":\"mr-5 \",\"children\":\"Category\"}]]}]]}],[\"$\",\"main\",null,{\"className\":\"w-full max-w-3xl\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",[\"slug\",\"LSS11\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",[\"$\",\"div\",null,{\"className\":\"mt-10 prose\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"\",\"children\":\"11장 - 뉴스 피드 시스템 설계\"}],[[\"$\",\"h2\",null,{\"children\":\"목표\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"뉴스피드는 여러분의 홈 페이지 중아에 지속적으로 업데이트되는 스토리들로 사용자 상태 정보 업데이트, 사진, 비디오, 링크, 앱 활동, 팔우하는 사람들, 페이지등을 포함한다고 설명하고있다.\\n이러한 뉴스피드를 설계하여보자.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"1단계 문제 이해 및 설계 범위 확정\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"어떤 기능을 지원해야하는지 반드시 파악해야 한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"지원자 질문\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"모바일 앱, 웹 둘다 지원해야하는지?\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"중요한 기능은 무엇인지\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스피드에는 어떤 순서로 스토리가 표시되어야 하는지?\\n최신 포스트가 위에? 토픽점수(가까운 친구의 포스트) 기준이 있는지?\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"한 명의 사용자는 최대 몇 명의 친구를 가질 수 있는지?\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"트래픽 규모는 어느 정도인지?\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"피드에 이미지나 비디오도 올라올 수 있는지?\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"면접관 질문\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"모바일 앱, 웹 둘다 지원해야함\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"중요한 기능으로 사용자는 뉴스 피드 페이지에 새로운 스토리를 올릴 수 있어야 하고, 친구들이 올리는 스토리를 볼 수도 있어야 한다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"시간 흐름 역순으로 피드 표현\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"한명은 최대 5000명과 친구 가능\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"트래픽의 규모는 매일 천만 명 방문\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"피드에 이미지나 비디오등 미디어 파일이 포함되어야함\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2단계 개략적 설계안 제시 및 동의 구하기\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"피드발행, 뉴스 피드 생성 두가지 부분으로 나누어 개략적 설계\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"피드 발행 : 피드를 생성하면 해당 데이터를 캐시와 데이터베이스에 기록하고 뉴스 피드에 전송된다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드 생성 : 뉴스 피드는 모든 친구의 포스팅을 역순으로 모아서 만든다고 가정\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"뉴스 피드 API\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"HTTP 기반으로 여러 작업을 수행하는 데 사용한다. 가장 중요한 두 가지 API를 알아보자\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"피드 발행 API\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"새 스토리를 포스팅하기 위한 API\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"인자\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"body : 포스팅 내용\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Authorization 헤더 : API 호출을 인증하기 위해 사용\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"피드 읽기 API\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"뉴스 피드를 가져오는 API\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"인자\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Authorization 헤더 : API 호출을 인증하기 위해 사용\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"피드 발행\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"/images/LSS/publishFeed.jpg\",\"width\":\"60%\",\"height\":\"100%\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"피드 발행 시스템의 개략적 형태는 다음과 같다.\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"사용자 : 모바일 앱이나 브라우저에서 새 포스팅을 올리는 주체\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"로드밸런서 : 트래픽을 웹 서버들로 분산한다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"웹 서버 : HTTP 요청을 내부 서비스로 중계하는 역할을 담당한다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"포스팅 저장 서비스 : 새 포스팅을 데이터베이스와 캐시에 저장\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"포스팅 전송 서비스 : 새 포스팅을 친구의 뉴스 피드에 푸시한다.\\n뉴스 피드 데이터는 캐시에 보관하여 빠르게 읽어갈 수 있도록 한다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"알림 서비스 : 친구들에게 새 포스팅이 올라왔음을 알림, 푸시 알림을 보냄\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"피드 생성\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"/images/LSS/createNewsFeed.jpg\",\"width\":\"50%\",\"height\":\"100%\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드 서비스 : 캐시에서 뉴스 피드를 가져오는 서비스다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드 캐시 : 뉴스 피드를 랜더링할 때 필요한 피드 ID를 보관\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"3단계 상세 설계\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"피드 발행 흐름 상세 설계\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"/images/LSS/publishFeedDetail.jpg\",\"width\":\"80%\",\"height\":\"100%\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"웹 서버\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"클라이언트와 통신 + 인증 + 처리율 제한 등 기능도 수행해야함\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"인증 : 인가한 사람만 게시물 등록\\n처리율 제한 : 스팸, 유해한 콘텐츠가 자주 올라오는 것을 방지하기 위해 특정기간 올리 수 있는 포스팅 수 제한\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"포스팅 전송(팬아웃) 서비스\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"포스팅 전송은 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정이다.\",[\"$\",\"br\",null,{}],\"\\n\",\"fanout에는 두가지 모델이 있다.\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"쓰기 시점에 팬아웃(fanout-on-write)\",[\"$\",\"br\",null,{}],\"\\n\",\"포스팅을 기록하는 시점에 뉴스 피드를 갱신, 해당 사용자의 캐시에 해당 포스팅을 기록하는 것\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"장점\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드가 실시간으로 갱신되며 친구 목록에 있는 사요자에게 즉시 전송\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"기록되는 순간 뉴스 피드가 이미 갱신되므로 뉴스 피드를 읽는 데 드는 시간이 짧아진다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"단점\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"친구가 많은 사용자의 경우 그 목록에 있는 사용자의 뉴스피드를 갱신하는데 많은 시간이 소요(핫키,hotkey 문제)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"서비스를 자주 이용하지 않는 사용자의 피드까지 갱신함으로 자원이 낭비\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"읽기 시점에 팬아웃(fanout-on-read)\",[\"$\",\"br\",null,{}],\"\\n\",\"피드를 읽어야하는 시점에 뉴스 피드를 갱신, 요청 기반 모델\",[\"$\",\"br\",null,{}],\"\\n\",\"즉, 사용자가 페이지를 로딩하는 시점에 포스트를 가져옴\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"장점\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"자주 사용하지않는 사용자, 비활성화된 사용자의 경우 유리\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"데이터를 친구 각각에 푸시하는 작업이 없어 핫키 문제가 생기지 않음\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"단점\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드를 읽는 데 많은 시간이 소요될 수 있다.\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이 두가지 방법을 결합하여 장점은 취하고 단점은 버리는 전략 사용\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"대부분의 사용자에 대해서 쓰기 시점에 팬 아웃하는 모델을 사용\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"팔로어가 아주 많은 사용자의 경우 읽기 시점에 팬 아웃하는 모델을 사용하여 과부화 방지\",[\"$\",\"br\",null,{}],\"\\n\",\"안정 해시를 이용해 요처오가 데이터를 고르게 분산하여 핫키 문제를 줄임\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"실제 팬아웃 서비스는 다음과 같이 작동한다\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"그래프 데이터베이스에서 친구 ID목록을 가져옴\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"사용자 정보 캐시에서 친구들의 정보 가져옴, 사용자 설정에 따라 친구 가운데 일부를 걸러냄(차단기능)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"친구 목록과 새 스토리의 포스팅 ID를 메시지 큐에 넣는다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"팬아웃 작업서버가 메시지 큐에서 데이터를 꺼내 뉴스 피드 데이터를 뉴스 피드 캐시에 넣는다.\",[\"$\",\"br\",null,{}],\"\\n\",\"뉴스 피드 캐시는 (포스팅 ID, 사용자 ID) 순서쌍으로 보관한다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"피드 읽기 흐름 상세 설계안\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"/images/LSS/createNewsFeedDetail.jpg\",\"width\":\"80%\",\"height\":\"100%\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이미자나 비디오는 CDN을 이용하여 빨리 읽어갈 수 있도록 최적화한다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"사용자의 요청이 들어온다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"로드밸런서가 요청을 웹서버 가운데 하나로 보낸다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"웹서버는 뉴스 피드 서비스를 호출해 피드를 가져온다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드 서비스는 뉴스 피드 캐시에서 포스팅 ID 목록을 가져온다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"뉴스 피드에 표시할 정보등을 사용자 캐시와 포스팅 캐시에서 가져와 완젼한 뉴스피드를 만든다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"생성된 뉴스피드는 JSON형태로 클라이언트에게 보낸다. 클라이언트는 해당 피드를 랜더링한다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"캐시 구조\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"캐시는 뉴스 피드 시스템의 핵심 컴포넌트다.\\n다음과 같이 다섯 계층으로 나누어 설계하였다.\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"뉴스피드 : 뉴스피드\",[\"$\",\"br\",null,{}],\"\\n\",\"뉴스 피드의 ID 보관\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"콘텐츠 : 인기 콘텐츠, 일반 콘텐츠\",[\"$\",\"br\",null,{}],\"\\n\",\"포스팅 데이터를 보관한다. 인기 콘텐츠는 따로 보관\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"소셜 그래프 : 팔로워, 팔로잉\",[\"$\",\"br\",null,{}],\"\\n\",\"사용자 간 관계 정보 보관\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"행동 : '좋아요', 답글, 기타\",[\"$\",\"br\",null,{}],\"\\n\",\"포스팅에 대한 사용자의 행위 정보 보관\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"횟수 : 좋아요 횟수, 답글 횟수, 기타\",[\"$\",\"br\",null,{}],\"\\n\",\"여러 횟수 정보를 보관한다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"4단계 마무리\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이번 설계안은 뉴스피드 발행과 생성의 두 부분으로 구성되어 있다.\",[\"$\",\"br\",null,{}],\"\\n\",\"설계 후 시간이 좀 남는다면 규모 확장성 이슈(데이터 베이스 규모확장)를 논의해보는 것도 괜찮다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이외에도 다음과 같은 항목을 이야기 해볼만하다.\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"웹 계층 을 무상태로 운영하기\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"가능한 한 많은 데이터를 캐시할 방법\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"여러 데이터 센터를 지원할 방법\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"메시지 큐를 사용하여 컴포넌트 사이의 결합도 낮추기\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"핵심 메트릭에 대한 모니터링\",[\"$\",\"br\",null,{}],\"\\n\",\"트래픽이 몰리는 시간 대의 QPS, 뉴스피드를 새로고침 할 떄의 지연시간 등\"]}],\"\\n\"]}]]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"LSS11\\\"}\"},\"styles\":[]}],\"segment\":[\"slug\",\"LSS11\",\"d\"]},\"styles\":[]}],\"segment\":\"blog\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"w-full max-w-3xl items-center \",\"children\":[[\"$\",\"div\",null,{\"className\":\"h-28\"}],\" \"]}]]}]]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"11장 - 뉴스 피드 시스템 설계\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"11장 - 뉴스 피드 시스템 설계 정리본\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"4\",{\"name\":\"google-site-verification\",\"content\":\"LXzAKbA2-HVF1l60gXdTElFNxVVLxh1rk6qwe1V41so\"}],[\"$\",\"link\",\"5\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"6\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script></body></html>